<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stock Life — PUBLICWORKS</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #f5f5f5;
      --bg-dark: #e8e8e8;
      --primary: #0F0F0F;
      --secondary: #6E6E6E;
      --accent: #0047FF;
      --muted: #999;
    }

    body {
      background: var(--bg);
      font-family: 'IBM Plex Mono', monospace;
      min-height: 100vh;
      color: var(--primary);
      overflow-x: hidden;
    }

    /* Back link */
    #back-link {
      position: fixed;
      top: 2rem;
      left: 2rem;
      font-size: 0.75rem;
      color: var(--secondary);
      text-decoration: none;
      z-index: 100;
      transition: color 0.15s ease;
    }

    #back-link:hover {
      color: var(--accent);
    }

    /* Main container */
    #app {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 4rem 2rem;
    }

    /* Title screen */
    #title-screen {
      text-align: center;
      max-width: 500px;
    }

    #title-screen h1 {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 1rem;
      letter-spacing: -0.02em;
    }

    #title-screen .subtitle {
      font-size: 0.875rem;
      color: var(--secondary);
      margin-bottom: 3rem;
      line-height: 1.6;
    }

    .start-btn {
      background: var(--primary);
      color: var(--bg);
      border: none;
      padding: 1rem 2.5rem;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .start-btn:hover {
      background: var(--accent);
      transform: translateY(-2px);
    }

    /* Game screen */
    #game-screen {
      display: none;
      width: 100%;
      max-width: 800px;
    }

    #game-screen.active {
      display: block;
    }

    /* Day counter */
    #day-counter {
      text-align: center;
      margin-bottom: 2rem;
    }

    #day-counter .label {
      font-size: 0.625rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: var(--secondary);
      margin-bottom: 0.25rem;
    }

    #day-counter .day {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 2rem;
      font-weight: 700;
    }

    /* Scenario container */
    #scenario-container {
      background: white;
      border: 1px solid var(--bg-dark);
      padding: 2rem;
      margin-bottom: 2rem;
    }

    #scenario-text {
      font-size: 1.125rem;
      line-height: 1.6;
      margin-bottom: 2rem;
      min-height: 3rem;
    }

    /* Choices */
    #choices {
      display: flex;
      gap: 1rem;
    }

    .choice-btn {
      flex: 1;
      background: var(--bg);
      border: 1px solid var(--bg-dark);
      padding: 1.25rem 1rem;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 0.8125rem;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    .choice-btn:hover {
      border-color: var(--primary);
      background: white;
    }

    .choice-btn:active {
      transform: scale(0.98);
    }

    /* Result display */
    #result-container {
      display: none;
      text-align: center;
    }

    #result-container.active {
      display: block;
    }

    #result-image-wrapper {
      position: relative;
      width: 100%;
      aspect-ratio: 16 / 10;
      background: var(--bg-dark);
      margin-bottom: 1.5rem;
      overflow: hidden;
    }

    #result-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    #result-image.loaded {
      opacity: 1;
    }

    #image-loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 0.625rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: var(--secondary);
    }

    #result-caption {
      font-size: 0.875rem;
      color: var(--secondary);
      font-style: italic;
      margin-bottom: 2rem;
      min-height: 1.5rem;
    }

    .continue-btn {
      background: none;
      border: 1px solid var(--primary);
      padding: 0.875rem 2rem;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .continue-btn:hover {
      background: var(--primary);
      color: var(--bg);
    }

    /* Journey tracker */
    #journey-tracker {
      margin-top: 3rem;
      padding-top: 2rem;
      border-top: 1px solid var(--bg-dark);
    }

    #journey-tracker .label {
      font-size: 0.625rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: var(--secondary);
      margin-bottom: 1rem;
      text-align: center;
    }

    #journey-thumbnails {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .journey-thumb {
      width: 60px;
      height: 40px;
      object-fit: cover;
      filter: grayscale(0.5);
      opacity: 0.7;
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .journey-thumb:hover {
      filter: grayscale(0);
      opacity: 1;
      transform: scale(1.1);
    }

    /* End screen */
    #end-screen {
      display: none;
      text-align: center;
      width: 100%;
      max-width: 900px;
    }

    #end-screen.active {
      display: block;
    }

    #end-screen h2 {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    #end-screen .end-subtitle {
      font-size: 0.875rem;
      color: var(--secondary);
      margin-bottom: 3rem;
    }

    /* Slideshow */
    #slideshow {
      position: relative;
      width: 100%;
      aspect-ratio: 16 / 10;
      background: var(--primary);
      margin-bottom: 2rem;
      overflow: hidden;
    }

    #slideshow-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: opacity 0.8s ease;
    }

    #slideshow-caption {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 2rem;
      background: linear-gradient(transparent, rgba(0,0,0,0.8));
      color: white;
      text-align: left;
    }

    #slideshow-day {
      font-size: 0.625rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      opacity: 0.7;
      margin-bottom: 0.25rem;
    }

    #slideshow-text {
      font-size: 0.875rem;
      opacity: 0.9;
    }

    #slideshow-progress {
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 0.625rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: white;
      opacity: 0.7;
    }

    /* Slideshow controls */
    #slideshow-controls {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .slideshow-btn {
      background: none;
      border: 1px solid var(--bg-dark);
      padding: 0.75rem 1.5rem;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 0.625rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .slideshow-btn:hover {
      border-color: var(--primary);
    }

    .slideshow-btn.active {
      background: var(--primary);
      color: var(--bg);
      border-color: var(--primary);
    }

    /* Gallery grid */
    #gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 0.5rem;
      margin-bottom: 3rem;
    }

    .gallery-item {
      position: relative;
      aspect-ratio: 16 / 10;
      overflow: hidden;
      cursor: pointer;
    }

    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .gallery-item:hover img {
      transform: scale(1.05);
    }

    .gallery-item .day-badge {
      position: absolute;
      top: 0.5rem;
      left: 0.5rem;
      background: rgba(0,0,0,0.7);
      color: white;
      font-size: 0.5rem;
      padding: 0.25rem 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    /* Stats */
    #life-stats {
      display: flex;
      justify-content: center;
      gap: 3rem;
      margin-bottom: 3rem;
      padding: 1.5rem;
      background: white;
      border: 1px solid var(--bg-dark);
    }

    .stat {
      text-align: center;
    }

    .stat-value {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .stat-label {
      font-size: 0.625rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--secondary);
      margin-top: 0.25rem;
    }

    .restart-btn {
      background: var(--primary);
      color: var(--bg);
      border: none;
      padding: 1rem 2.5rem;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .restart-btn:hover {
      background: var(--accent);
    }

    /* Watermark */
    #watermark {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      font-size: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--muted);
      opacity: 0.5;
    }

    /* Hidden */
    .hidden {
      display: none !important;
    }

    /* Responsive */
    @media (max-width: 600px) {
      #title-screen h1 {
        font-size: 2rem;
      }

      #choices {
        flex-direction: column;
      }

      #life-stats {
        flex-direction: column;
        gap: 1.5rem;
      }

      .journey-thumb {
        width: 40px;
        height: 28px;
      }
    }
  </style>
</head>
<body>
  <a href="../../" id="back-link">← PUBLICWORKS</a>

  <div id="app">
    <!-- Title Screen -->
    <div id="title-screen">
      <h1>Stock Life</h1>
      <p class="subtitle">
        Live your life through the lens of generic stock photography.
        Every choice you make will be immortalized in the most banal visual language possible.
      </p>
      <button class="start-btn" onclick="startGame()">Begin Your Journey</button>
    </div>

    <!-- Game Screen -->
    <div id="game-screen">
      <div id="day-counter">
        <div class="label">Day</div>
        <div class="day" id="current-day">1</div>
      </div>

      <div id="scenario-container">
        <p id="scenario-text"></p>
        <div id="choices"></div>
      </div>

      <div id="result-container">
        <div id="result-image-wrapper">
          <span id="image-loading">Loading your reality...</span>
          <img id="result-image" src="" alt="Your choice visualized">
        </div>
        <p id="result-caption"></p>
        <button class="continue-btn" onclick="nextDay()">Continue Living</button>
      </div>

      <div id="journey-tracker">
        <div class="label">Your Journey So Far</div>
        <div id="journey-thumbnails"></div>
      </div>
    </div>

    <!-- End Screen -->
    <div id="end-screen">
      <h2>Your Stock Life</h2>
      <p class="end-subtitle">A visual memoir in generic imagery</p>

      <div id="slideshow">
        <img id="slideshow-image" src="" alt="">
        <div id="slideshow-caption">
          <div id="slideshow-day">Day 1</div>
          <div id="slideshow-text"></div>
        </div>
        <div id="slideshow-progress">1 / 10</div>
      </div>

      <div id="slideshow-controls">
        <button class="slideshow-btn" onclick="prevSlide()">← Prev</button>
        <button class="slideshow-btn" id="play-pause-btn" onclick="toggleAutoplay()">▶ Play</button>
        <button class="slideshow-btn" onclick="nextSlide()">Next →</button>
      </div>

      <div id="gallery"></div>

      <div id="life-stats">
        <div class="stat">
          <div class="stat-value" id="stat-days">10</div>
          <div class="stat-label">Days Lived</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="stat-bold">0</div>
          <div class="stat-label">Bold Choices</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="stat-safe">0</div>
          <div class="stat-label">Safe Choices</div>
        </div>
      </div>

      <button class="restart-btn" onclick="restartGame()">Live Another Life</button>
    </div>
  </div>

  <div id="watermark">Stock Life™</div>

  <script>
    (function() {
      'use strict';

      // ---------- Configuration ----------
      const CONFIG = {
        pexelsApiKey: 'btO65X761pJo6C66T3ekHHTuXucIvixeYrg00NqFi8WNVO2NCKplJ7FY',
        daysToLive: 10,
        slideshowInterval: 4000,
      };

      // ---------- Life Scenarios ----------
      const SCENARIOS = [
        {
          text: "Your alarm goes off. It's Monday morning.",
          choices: [
            { text: "Get up and face the day", query: "person waking up morning", caption: "You chose productivity.", type: "bold" },
            { text: "Hit snooze (again)", query: "person sleeping bed cozy", caption: "You chose comfort.", type: "safe" }
          ]
        },
        {
          text: "You're hungry. The fridge is nearly empty.",
          choices: [
            { text: "Cook something from scratch", query: "person cooking kitchen happy", caption: "You chose self-sufficiency.", type: "bold" },
            { text: "Order delivery", query: "food delivery box doorstep", caption: "You chose convenience.", type: "safe" }
          ]
        },
        {
          text: "Your phone buzzes with a message from an old friend.",
          choices: [
            { text: "Call them back immediately", query: "friends phone call smiling", caption: "You chose connection.", type: "bold" },
            { text: "Reply with a thumbs up emoji", query: "person texting phone alone", caption: "You chose... efficiency.", type: "safe" }
          ]
        },
        {
          text: "You have a free afternoon stretching before you.",
          choices: [
            { text: "Go for a walk in nature", query: "person hiking nature trail", caption: "You chose the outdoors.", type: "bold" },
            { text: "Marathon a TV series", query: "person watching tv couch relaxed", caption: "You chose entertainment.", type: "safe" }
          ]
        },
        {
          text: "A coworker invites you to their birthday party.",
          choices: [
            { text: "Show up with a thoughtful gift", query: "office party celebration coworkers", caption: "You chose camaraderie.", type: "bold" },
            { text: "Send a polite decline", query: "person alone peaceful home", caption: "You chose solitude.", type: "safe" }
          ]
        },
        {
          text: "You spot a help wanted sign at a quirky local shop.",
          choices: [
            { text: "Inquire about the position", query: "job interview handshake office", caption: "You chose opportunity.", type: "bold" },
            { text: "Walk past, you have a job", query: "person walking city street", caption: "You chose stability.", type: "safe" }
          ]
        },
        {
          text: "The gym membership expires tomorrow.",
          choices: [
            { text: "Renew it and commit", query: "person exercising gym fitness", caption: "You chose health.", type: "bold" },
            { text: "Let it lapse gracefully", query: "person relaxing home comfortable", caption: "You chose acceptance.", type: "safe" }
          ]
        },
        {
          text: "A stranger drops their wallet on the sidewalk.",
          choices: [
            { text: "Chase them down to return it", query: "people helping street kindness", caption: "You chose integrity.", type: "bold" },
            { text: "Someone else will handle it", query: "busy city crowd walking", caption: "You chose... probability.", type: "safe" }
          ]
        },
        {
          text: "You wake up with a sudden creative idea.",
          choices: [
            { text: "Start working on it immediately", query: "creative person working passionate", caption: "You chose inspiration.", type: "bold" },
            { text: "Write it down for later", query: "notebook pen desk planning", caption: "You chose documentation.", type: "safe" }
          ]
        },
        {
          text: "Your parents want to video chat.",
          choices: [
            { text: "Accept and chat for an hour", query: "video call family happy smiling", caption: "You chose family.", type: "bold" },
            { text: "Text that you'll call later", query: "person busy phone distracted", caption: "You chose postponement.", type: "safe" }
          ]
        },
        {
          text: "The weekend is here. No plans yet.",
          choices: [
            { text: "Plan a spontaneous trip", query: "road trip car adventure scenic", caption: "You chose adventure.", type: "bold" },
            { text: "Enjoy a quiet weekend at home", query: "cozy home weekend relaxing coffee", caption: "You chose peace.", type: "safe" }
          ]
        },
        {
          text: "You receive a difficult email at work.",
          choices: [
            { text: "Address it head-on", query: "professional person computer focused", caption: "You chose confrontation.", type: "bold" },
            { text: "Deal with it tomorrow", query: "person stressed work office", caption: "You chose delay.", type: "safe" }
          ]
        },
        {
          text: "A charity asks for a donation at the store.",
          choices: [
            { text: "Contribute generously", query: "donation charity giving hands", caption: "You chose generosity.", type: "bold" },
            { text: "Politely decline this time", query: "shopping bags store retail", caption: "You chose boundaries.", type: "safe" }
          ]
        },
        {
          text: "Your favorite coffee shop has a new unusual flavor.",
          choices: [
            { text: "Try something new", query: "person drinking coffee happy cafe", caption: "You chose curiosity.", type: "bold" },
            { text: "Stick with your regular order", query: "coffee cup classic simple", caption: "You chose reliability.", type: "safe" }
          ]
        },
        {
          text: "The sunset looks particularly beautiful today.",
          choices: [
            { text: "Stop and take it in", query: "person watching sunset peaceful", caption: "You chose presence.", type: "bold" },
            { text: "Glance at it while walking", query: "sunset city skyline urban", caption: "You chose efficiency.", type: "safe" }
          ]
        },
        {
          text: "A new book everyone's talking about catches your eye.",
          choices: [
            { text: "Buy it and start tonight", query: "person reading book cozy", caption: "You chose knowledge.", type: "bold" },
            { text: "Add it to your reading list", query: "bookshelf books library organized", caption: "You chose intention.", type: "safe" }
          ]
        },
        {
          text: "You're stuck in a long checkout line.",
          choices: [
            { text: "Strike up conversation with someone", query: "people talking friendly conversation", caption: "You chose connection.", type: "bold" },
            { text: "Browse your phone quietly", query: "person phone waiting alone", caption: "You chose distraction.", type: "safe" }
          ]
        },
        {
          text: "Rain starts falling as you leave work.",
          choices: [
            { text: "Dance in it a little", query: "person rain happy playful", caption: "You chose joy.", type: "bold" },
            { text: "Run to shelter immediately", query: "rain umbrella city street", caption: "You chose pragmatism.", type: "safe" }
          ]
        },
        {
          text: "Your neighbor needs help moving a couch.",
          choices: [
            { text: "Offer to help right away", query: "neighbors helping community teamwork", caption: "You chose community.", type: "bold" },
            { text: "Pretend you didn't hear", query: "person home quiet peaceful", caption: "You chose self-preservation.", type: "safe" }
          ]
        },
        {
          text: "It's late. You could keep working or rest.",
          choices: [
            { text: "Push through and finish", query: "person working late night dedicated", caption: "You chose dedication.", type: "bold" },
            { text: "Rest now, finish tomorrow", query: "person sleeping peaceful night", caption: "You chose balance.", type: "safe" }
          ]
        }
      ];

      // ---------- State ----------
      let currentDay = 1;
      let journey = [];
      let usedScenarios = [];
      let slideshowIndex = 0;
      let autoplayInterval = null;
      let boldChoices = 0;
      let safeChoices = 0;

      // ---------- DOM Elements ----------
      const titleScreen = document.getElementById('title-screen');
      const gameScreen = document.getElementById('game-screen');
      const endScreen = document.getElementById('end-screen');
      const scenarioText = document.getElementById('scenario-text');
      const choicesContainer = document.getElementById('choices');
      const resultContainer = document.getElementById('result-container');
      const scenarioContainer = document.getElementById('scenario-container');
      const resultImage = document.getElementById('result-image');
      const resultCaption = document.getElementById('result-caption');
      const imageLoading = document.getElementById('image-loading');
      const currentDayEl = document.getElementById('current-day');
      const journeyThumbnails = document.getElementById('journey-thumbnails');
      const slideshowImage = document.getElementById('slideshow-image');
      const slideshowDay = document.getElementById('slideshow-day');
      const slideshowText = document.getElementById('slideshow-text');
      const slideshowProgress = document.getElementById('slideshow-progress');
      const gallery = document.getElementById('gallery');
      const playPauseBtn = document.getElementById('play-pause-btn');

      // ---------- API Functions ----------
      async function fetchStockImage(query) {
        try {
          const response = await fetch(
            `https://api.pexels.com/v1/search?query=${encodeURIComponent(query)}&per_page=15&orientation=landscape`,
            { headers: { 'Authorization': CONFIG.pexelsApiKey } }
          );

          if (response.ok) {
            const data = await response.json();
            if (data.photos && data.photos.length > 0) {
              // Pick a random photo from results for variety
              const photo = data.photos[Math.floor(Math.random() * data.photos.length)];
              return {
                url: photo.src.large,
                thumb: photo.src.small,
                alt: photo.alt || query
              };
            }
          }
        } catch (e) {
          console.warn('Failed to fetch image:', e);
        }

        // Fallback
        return {
          url: `https://placehold.co/800x500/e8e8e8/999999?text=Your+Life`,
          thumb: `https://placehold.co/150x100/e8e8e8/999999?text=...`,
          alt: 'Your life moment'
        };
      }

      // ---------- Game Functions ----------
      function startGame() {
        titleScreen.classList.add('hidden');
        gameScreen.classList.add('active');
        currentDay = 1;
        journey = [];
        usedScenarios = [];
        boldChoices = 0;
        safeChoices = 0;
        updateJourneyDisplay();
        presentScenario();
      }

      function getRandomScenario() {
        const available = SCENARIOS.filter((_, i) => !usedScenarios.includes(i));
        if (available.length === 0) {
          usedScenarios = [];
          return SCENARIOS[Math.floor(Math.random() * SCENARIOS.length)];
        }
        const index = SCENARIOS.indexOf(available[Math.floor(Math.random() * available.length)]);
        usedScenarios.push(index);
        return SCENARIOS[index];
      }

      function presentScenario() {
        currentDayEl.textContent = currentDay;
        resultContainer.classList.remove('active');
        scenarioContainer.style.display = 'block';

        const scenario = getRandomScenario();
        scenarioText.textContent = scenario.text;

        choicesContainer.innerHTML = '';
        scenario.choices.forEach((choice, index) => {
          const btn = document.createElement('button');
          btn.className = 'choice-btn';
          btn.textContent = choice.text;
          btn.onclick = () => makeChoice(choice);
          choicesContainer.appendChild(btn);
        });
      }

      async function makeChoice(choice) {
        // Disable choices while loading
        const buttons = choicesContainer.querySelectorAll('.choice-btn');
        buttons.forEach(btn => btn.disabled = true);

        // Track choice type
        if (choice.type === 'bold') {
          boldChoices++;
        } else {
          safeChoices++;
        }

        // Show result container with loading state
        scenarioContainer.style.display = 'none';
        resultContainer.classList.add('active');
        resultImage.classList.remove('loaded');
        imageLoading.style.display = 'block';

        // Fetch stock image
        const image = await fetchStockImage(choice.query);

        // Store in journey
        journey.push({
          day: currentDay,
          choice: choice.text,
          caption: choice.caption,
          image: image,
          type: choice.type
        });

        // Display result
        resultImage.onload = () => {
          resultImage.classList.add('loaded');
          imageLoading.style.display = 'none';
        };
        resultImage.src = image.url;
        resultCaption.textContent = choice.caption;

        // Update journey display
        updateJourneyDisplay();
      }

      function updateJourneyDisplay() {
        journeyThumbnails.innerHTML = '';
        journey.forEach((moment, index) => {
          const thumb = document.createElement('img');
          thumb.className = 'journey-thumb';
          thumb.src = moment.image.thumb;
          thumb.alt = `Day ${moment.day}`;
          thumb.title = `Day ${moment.day}: ${moment.choice}`;
          thumb.onclick = () => showMomentDetail(index);
          journeyThumbnails.appendChild(thumb);
        });
      }

      function showMomentDetail(index) {
        const moment = journey[index];
        // Could expand to show modal, for now just visual feedback
        const thumbs = journeyThumbnails.querySelectorAll('.journey-thumb');
        thumbs.forEach((t, i) => {
          t.style.opacity = i === index ? '1' : '0.5';
          t.style.filter = i === index ? 'grayscale(0)' : 'grayscale(0.5)';
        });
        setTimeout(() => {
          thumbs.forEach(t => {
            t.style.opacity = '';
            t.style.filter = '';
          });
        }, 1500);
      }

      function nextDay() {
        currentDay++;
        if (currentDay > CONFIG.daysToLive) {
          endGame();
        } else {
          presentScenario();
        }
      }

      function endGame() {
        gameScreen.classList.remove('active');
        endScreen.classList.add('active');

        // Update stats
        document.getElementById('stat-days').textContent = journey.length;
        document.getElementById('stat-bold').textContent = boldChoices;
        document.getElementById('stat-safe').textContent = safeChoices;

        // Build gallery
        gallery.innerHTML = '';
        journey.forEach((moment, index) => {
          const item = document.createElement('div');
          item.className = 'gallery-item';
          item.innerHTML = `
            <img src="${moment.image.url}" alt="Day ${moment.day}">
            <div class="day-badge">Day ${moment.day}</div>
          `;
          item.onclick = () => goToSlide(index);
          gallery.appendChild(item);
        });

        // Start slideshow
        slideshowIndex = 0;
        updateSlideshow();
      }

      function updateSlideshow() {
        if (journey.length === 0) return;

        const moment = journey[slideshowIndex];
        slideshowImage.src = moment.image.url;
        slideshowDay.textContent = `Day ${moment.day}`;
        slideshowText.textContent = `${moment.choice} — ${moment.caption}`;
        slideshowProgress.textContent = `${slideshowIndex + 1} / ${journey.length}`;
      }

      function nextSlide() {
        slideshowIndex = (slideshowIndex + 1) % journey.length;
        updateSlideshow();
      }

      function prevSlide() {
        slideshowIndex = (slideshowIndex - 1 + journey.length) % journey.length;
        updateSlideshow();
      }

      function goToSlide(index) {
        slideshowIndex = index;
        updateSlideshow();
      }

      function toggleAutoplay() {
        if (autoplayInterval) {
          clearInterval(autoplayInterval);
          autoplayInterval = null;
          playPauseBtn.textContent = '▶ Play';
          playPauseBtn.classList.remove('active');
        } else {
          autoplayInterval = setInterval(nextSlide, CONFIG.slideshowInterval);
          playPauseBtn.textContent = '⏸ Pause';
          playPauseBtn.classList.add('active');
        }
      }

      function restartGame() {
        // Clear autoplay if running
        if (autoplayInterval) {
          clearInterval(autoplayInterval);
          autoplayInterval = null;
          playPauseBtn.textContent = '▶ Play';
          playPauseBtn.classList.remove('active');
        }

        endScreen.classList.remove('active');
        gameScreen.classList.remove('active');
        titleScreen.classList.remove('hidden');
      }

      // ---------- Expose to global scope for onclick handlers ----------
      window.startGame = startGame;
      window.nextDay = nextDay;
      window.nextSlide = nextSlide;
      window.prevSlide = prevSlide;
      window.toggleAutoplay = toggleAutoplay;
      window.restartGame = restartGame;

    })();
  </script>
</body>
</html>
