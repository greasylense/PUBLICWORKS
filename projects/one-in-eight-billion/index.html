<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0A0A0A">
  <meta name="description" content="Discover how unique you are among 8 billion people through an interactive visualization.">
  <title>One in 8 Billion — PUBLICWORKS</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #0A0A0A;
      --bg-light: #141414;
      --text: #FFFFFF;
      --text-secondary: #888888;
      --accent: #0047FF;
      --accent-glow: rgba(0, 71, 255, 0.4);
      --warm: #FF4D00;
      --glass: rgba(10, 10, 10, 0.98);
      --glass-border: rgba(255, 255, 255, 0.1);
      --font-display: 'Space Grotesk', system-ui, sans-serif;
      --font-mono: 'IBM Plex Mono', 'SF Mono', monospace;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: var(--font-mono);
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    #back-link {
      position: fixed;
      top: 1.5rem;
      left: 1.5rem;
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-decoration: none;
      z-index: 1000;
      transition: color 0.15s ease;
      padding: 0.5rem 1rem;
      background: var(--glass);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
    }
    #back-link:hover { color: var(--accent); }

    #canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
    }

    .ui-layer {
      position: relative;
      z-index: 10;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      pointer-events: none;
    }

    .ui-layer > * { pointer-events: auto; }

    /* Glass Card */
    .glass-card {
      background: rgba(10, 10, 10, 1);
      backdrop-filter: blur(40px);
      -webkit-backdrop-filter: blur(40px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 3rem;
      max-width: 560px;
      width: 100%;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.9), 0 0 0 1px rgba(255, 255, 255, 0.1);
    }

    /* Start Screen */
    .start-screen {
      text-align: center;
    }

    .start-screen h1 {
      font-family: var(--font-display);
      font-size: clamp(2.5rem, 10vw, 4rem);
      font-weight: 700;
      letter-spacing: -0.04em;
      margin-bottom: 0.5rem;
      line-height: 1;
      background: linear-gradient(135deg, #FFFFFF 0%, #888888 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .start-screen .tagline {
      font-family: var(--font-display);
      font-size: 1.125rem;
      color: var(--accent);
      margin-bottom: 2rem;
      font-weight: 500;
    }

    .start-screen .subtitle {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 2rem;
      line-height: 1.7;
    }

    .dot-preview {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      margin-bottom: 2.5rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--glass-border);
    }

    .dot-grid {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 3px;
    }

    .dot-grid span {
      width: 4px;
      height: 4px;
      background: var(--accent);
      border-radius: 50%;
      opacity: 0.6;
    }

    .dot-preview p {
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-align: left;
      line-height: 1.5;
    }

    .dot-preview p strong {
      color: var(--text);
      font-weight: 500;
    }

    .btn {
      font-family: var(--font-mono);
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--bg);
      background: var(--text);
      border: none;
      padding: 1rem 2.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .btn:hover {
      background: var(--accent);
      color: var(--text);
      transform: translateY(-2px);
      box-shadow: 0 10px 40px var(--accent-glow);
    }

    .btn-secondary {
      background: transparent;
      color: var(--text);
      border: 1px solid var(--glass-border);
    }
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text);
      box-shadow: none;
      transform: none;
    }

    /* Question Screen */
    .question-screen {
      display: none;
      text-align: center;
    }

    .progress-container {
      margin-bottom: 2rem;
    }

    .progress-bar {
      width: 100%;
      height: 2px;
      background: rgba(255, 255, 255, 0.1);
      margin-bottom: 1rem;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent) 0%, #00D4FF 100%);
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 0 20px var(--accent-glow);
    }

    .progress-stats {
      display: flex;
      justify-content: space-between;
      font-size: 0.625rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .population-remaining {
      color: var(--accent);
    }

    .question-number {
      font-size: 0.625rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      margin-bottom: 1rem;
    }

    .question-text {
      font-family: var(--font-display);
      font-size: clamp(1.5rem, 5vw, 2rem);
      font-weight: 700;
      margin-bottom: 2rem;
      line-height: 1.2;
      letter-spacing: -0.02em;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .option-btn {
      font-family: var(--font-mono);
      font-size: 0.875rem;
      color: var(--text);
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--glass-border);
      padding: 1rem 1.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: left;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .option-btn:hover {
      border-color: var(--accent);
      background: rgba(0, 71, 255, 0.1);
      transform: translateX(4px);
    }
    .option-btn .percent {
      font-size: 0.75rem;
      color: var(--text-secondary);
      opacity: 0;
      transition: all 0.2s ease;
    }
    .option-btn:hover .percent {
      opacity: 1;
      color: var(--accent);
    }

    .skip-btn {
      font-size: 0.75rem;
      color: var(--text-secondary);
      background: none;
      border: none;
      cursor: pointer;
      padding: 0.75rem;
      transition: color 0.15s ease;
    }
    .skip-btn:hover { color: var(--text); }

    /* Insight Panel */
    .insight-panel {
      display: none;
      text-align: center;
    }

    .insight-stat-container {
      margin-bottom: 2rem;
    }

    .insight-stat {
      font-family: var(--font-display);
      font-size: clamp(4rem, 15vw, 6rem);
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent) 0%, #00D4FF 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1;
      margin-bottom: 0.5rem;
    }

    .insight-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.15em;
    }

    .insight-text {
      font-size: 0.9375rem;
      color: var(--text-secondary);
      line-height: 1.8;
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.03);
      border-left: 2px solid var(--accent);
    }

    .remaining-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--glass-border);
    }

    .remaining-stat {
      text-align: center;
    }

    .remaining-stat .value {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 0.25rem;
    }

    .remaining-stat .label {
      font-size: 0.625rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    /* Results Screen */
    .results-screen {
      display: none;
      text-align: center;
      max-width: 640px;
    }

    .results-header {
      margin-bottom: 2rem;
    }

    .results-header .pre-text {
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      margin-bottom: 0.5rem;
    }

    .archetype-name {
      font-family: var(--font-display);
      font-size: clamp(1.75rem, 6vw, 2.5rem);
      font-weight: 700;
      background: linear-gradient(135deg, #FFFFFF 0%, var(--accent) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 1rem;
    }

    .results-description {
      font-size: 0.9375rem;
      line-height: 1.7;
      color: var(--text-secondary);
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1px;
      background: var(--glass-border);
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--bg-light);
      padding: 1.5rem;
      text-align: center;
    }

    .stat-card.featured {
      grid-column: span 2;
      background: linear-gradient(135deg, rgba(0, 71, 255, 0.2) 0%, rgba(0, 212, 255, 0.1) 100%);
    }

    .stat-card .value {
      font-family: var(--font-display);
      font-size: 2rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 0.25rem;
    }

    .stat-card.featured .value {
      font-size: 3rem;
      background: linear-gradient(135deg, var(--accent) 0%, #00D4FF 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .stat-card .label {
      font-size: 0.625rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      line-height: 1.4;
    }

    .stat-card .sublabel {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-top: 0.5rem;
    }

    /* Trait List */
    .trait-section {
      margin-bottom: 2rem;
      text-align: left;
    }

    .trait-section h3 {
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--glass-border);
    }

    .trait-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.875rem;
      padding: 0.75rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    .trait-item:last-child { border-bottom: none; }

    .trait-item .trait-name {
      color: var(--text);
    }

    .trait-item .trait-rarity {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .rarity-bar {
      width: 60px;
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      overflow: hidden;
    }

    .rarity-fill {
      height: 100%;
      background: var(--accent);
      transition: width 0.5s ease;
    }

    .rarity-fill.rare {
      background: linear-gradient(90deg, var(--accent) 0%, #00D4FF 100%);
    }

    .rarity-fill.very-rare {
      background: linear-gradient(90deg, var(--warm) 0%, #FF8A00 100%);
    }

    .trait-item .percent {
      font-size: 0.75rem;
      color: var(--text-secondary);
      min-width: 50px;
      text-align: right;
    }

    .trait-item .percent.rare { color: var(--accent); }
    .trait-item .percent.very-rare { color: var(--warm); }

    /* Comparison Section */
    .comparison-section {
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--glass-border);
    }

    .comparison-section h3 {
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 1rem;
    }

    .comparison-bar {
      position: relative;
      height: 40px;
      background: linear-gradient(90deg, var(--accent) 0%, var(--warm) 100%);
      margin-bottom: 0.5rem;
      overflow: visible;
    }

    .comparison-marker {
      position: absolute;
      top: -8px;
      width: 2px;
      height: 56px;
      background: var(--text);
      transform: translateX(-50%);
    }

    .comparison-marker::after {
      content: 'YOU';
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.625rem;
      color: var(--text);
      font-weight: 500;
      letter-spacing: 0.1em;
    }

    .comparison-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.625rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .button-group {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    /* Responsive */
    @media (min-width: 600px) {
      .glass-card {
        padding: 3.5rem;
      }

      .options {
        flex-direction: row;
        flex-wrap: wrap;
      }
      .option-btn {
        flex: 1 1 calc(50% - 0.25rem);
        min-width: 200px;
      }
    }

    @media (max-width: 480px) {
      .glass-card {
        padding: 2rem 1.5rem;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .stat-card.featured {
        grid-column: span 1;
      }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-10px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes countUp {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }

    .animate-in {
      animation: fadeInUp 0.6s ease forwards;
    }

    .animate-in-delay-1 { animation-delay: 0.1s; opacity: 0; }
    .animate-in-delay-2 { animation-delay: 0.2s; opacity: 0; }
    .animate-in-delay-3 { animation-delay: 0.3s; opacity: 0; }
    .animate-in-delay-4 { animation-delay: 0.4s; opacity: 0; }

    /* Screen transitions */
    .glass-card {
      transition: opacity 0.4s ease, transform 0.4s ease;
    }

    .glass-card.fade-out {
      opacity: 0;
      transform: scale(0.98);
    }

    .glass-card.fade-in {
      animation: fadeInUp 0.5s ease forwards;
    }

    /* Option selection animation */
    .option-btn.selected {
      border-color: var(--accent) !important;
      background: rgba(0, 71, 255, 0.2) !important;
      transform: scale(1.02);
    }

    .option-btn.not-selected {
      opacity: 0.3;
      transform: scale(0.98);
      pointer-events: none;
    }

    /* Insight stat animation */
    .insight-stat.counting {
      animation: countUp 0.6s ease forwards;
    }

    /* Live counter in header */
    .live-counter {
      position: fixed;
      top: 1.5rem;
      right: 1.5rem;
      font-size: 0.625rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      z-index: 1000;
      padding: 0.5rem 1rem;
      background: var(--glass);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      display: none;
    }

    .live-counter.visible {
      display: block;
    }

    .live-counter .count {
      color: var(--accent);
      font-weight: 500;
      font-size: 0.75rem;
    }

    /* Dot pulse effect on selection */
    .selection-pulse {
      position: fixed;
      border-radius: 50%;
      pointer-events: none;
      z-index: 5;
      animation: selectionPulse 1s ease forwards;
    }

    @keyframes selectionPulse {
      0% {
        transform: scale(0);
        opacity: 0.8;
      }
      100% {
        transform: scale(4);
        opacity: 0;
      }
    }

    /* Most/Least Average Person comparison */
    .comparison-profiles {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
      font-size: 0.75rem;
    }

    .profile-card {
      padding: 1rem;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--glass-border);
    }

    .profile-card h4 {
      font-size: 0.625rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 0.5rem;
    }

    .profile-card p {
      color: var(--text);
      line-height: 1.5;
    }

    .profile-card.average {
      border-color: var(--accent);
    }

    .profile-card.unique {
      border-color: var(--warm);
    }
  </style>
</head>
<body>
  <a href="../../" id="back-link">← PUBLICWORKS</a>
  <div class="live-counter" id="live-counter">
    <span class="count" id="live-count">8B</span> people remaining
  </div>
  <canvas id="canvas"></canvas>

  <div class="ui-layer">
    <!-- Start Screen -->
    <div class="start-screen glass-card" id="start-screen">
      <h1>One in 8 Billion</h1>
      <p class="tagline">How unique are you, really?</p>
      <p class="subtitle">
        Answer 23 questions and watch as we filter through all of humanity to find people statistically similar to you.
      </p>
      <div class="dot-preview">
        <div class="dot-grid">
          <span></span><span></span><span></span><span></span><span></span>
          <span></span><span></span><span></span><span></span><span></span>
          <span></span><span></span><span></span><span></span><span></span>
          <span></span><span></span><span></span><span></span><span></span>
        </div>
        <p><strong>100,000 dots</strong><br>Each represents 80,000 people<br>Together: all 8 billion of us</p>
      </div>
      <button class="btn" id="start-btn">Begin the Journey</button>
    </div>

    <!-- Question Screen -->
    <div class="question-screen glass-card" id="question-screen">
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-stats">
          <span id="question-counter">Question 1 of 23</span>
          <span class="population-remaining" id="population-display">8B remaining</span>
        </div>
      </div>
      <p class="question-number" id="question-number">Demographics</p>
      <h2 class="question-text" id="question-text"></h2>
      <div class="options" id="options"></div>
      <button class="skip-btn" id="skip-btn">Skip this question →</button>
    </div>

    <!-- Insight Panel -->
    <div class="insight-panel glass-card" id="insight-panel">
      <div class="insight-stat-container">
        <p class="insight-stat" id="insight-stat"></p>
        <p class="insight-label" id="insight-label"></p>
      </div>
      <p class="insight-text" id="insight-text"></p>
      <div class="remaining-stats">
        <div class="remaining-stat">
          <p class="value" id="remaining-absolute"></p>
          <p class="label">People share<br>this exact trait</p>
        </div>
        <div class="remaining-stat">
          <p class="value" id="remaining-cumulative"></p>
          <p class="label">Match all your<br>answers so far</p>
        </div>
      </div>
      <button class="btn" id="continue-btn">Continue</button>
    </div>

    <!-- Results Screen -->
    <div class="results-screen glass-card" id="results-screen">
      <div class="results-header animate-in">
        <p class="pre-text">Your uniqueness profile</p>
        <h2 class="archetype-name" id="archetype-name"></h2>
        <p class="results-description" id="results-description"></p>
      </div>

      <div class="stats-grid animate-in animate-in-delay-1">
        <div class="stat-card featured">
          <p class="value" id="similar-people"></p>
          <p class="label">Estimated people with similar traits</p>
          <p class="sublabel" id="similarity-note"></p>
        </div>
        <div class="stat-card">
          <p class="value" id="uniqueness-score"></p>
          <p class="label">Uniqueness<br>Score</p>
        </div>
        <div class="stat-card">
          <p class="value" id="rare-trait-count"></p>
          <p class="label">Rare traits<br>(under 10%)</p>
        </div>
        <div class="stat-card">
          <p class="value" id="common-trait-count"></p>
          <p class="label">Common traits<br>(over 40%)</p>
        </div>
        <div class="stat-card">
          <p class="value" id="rarest-percentile"></p>
          <p class="label">Your rarest<br>trait</p>
        </div>
      </div>

      <div class="comparison-section animate-in animate-in-delay-2">
        <h3>Where you fall on the uniqueness spectrum</h3>
        <div class="comparison-bar">
          <div class="comparison-marker" id="comparison-marker"></div>
        </div>
        <div class="comparison-labels">
          <span>Most Common</span>
          <span>Average</span>
          <span>Very Unique</span>
        </div>
        <div class="comparison-profiles">
          <div class="profile-card average">
            <h4>Most Average Person</h4>
            <p>28-year-old Han Chinese man living in an Asian city, brown eyes, black hair, right-handed, O+ blood type</p>
          </div>
          <div class="profile-card unique">
            <h4>Most Unique Possible</h4>
            <p>Ambidextrous person from Oceania with gray eyes, red hair, AB- blood, speaking 4+ languages, vegan</p>
          </div>
        </div>
      </div>

      <div class="trait-section animate-in animate-in-delay-3" id="trait-section">
        <h3>Your Trait Breakdown</h3>
      </div>

      <div class="button-group animate-in animate-in-delay-4">
        <button class="btn" id="restart-btn">Start Over</button>
        <button class="btn btn-secondary" id="share-btn">Copy Results</button>
      </div>
    </div>
  </div>

  <script>
    (function() {
      'use strict';

      // ============================================
      // GLOBAL STATISTICS DATA
      // Sources: UN, WHO, Pew Research, scientific studies
      // ============================================
      const QUESTIONS = [
        {
          id: 'age',
          category: 'Demographics',
          question: 'What is your age range?',
          options: [
            { label: '0-14', percent: 25.4 },
            { label: '15-24', percent: 15.5 },
            { label: '25-34', percent: 15.3 },
            { label: '35-44', percent: 13.2 },
            { label: '45-54', percent: 11.8 },
            { label: '55-64', percent: 9.3 },
            { label: '65+', percent: 9.5 }
          ],
          insight: {
            stat: (p) => `${p.toFixed(1)}%`,
            label: 'of all humans',
            getText: (opt) => {
              const insights = {
                '0-14': 'You are part of the youngest generation. There are about 2 billion people under 15 on Earth—more than the entire global population in 1900.',
                '15-24': 'You are in what the UN calls the "youth bulge"—a generation that will shape the next century of human history.',
                '25-34': 'This is the largest working-age cohort globally. People your age are building families, careers, and the future economy.',
                '35-44': 'You are in prime earning and influence years. Globally, this age group leads businesses and raises the next generation.',
                '45-54': 'You have witnessed tremendous change—from no internet to AI in a single lifetime. Your generation bridges two eras.',
                '55-64': 'This demographic is growing and gaining political influence. In many countries, your age group is the largest voting bloc.',
                '65+': 'You are part of the fastest-growing demographic. People over 65 have tripled since 1950—a testament to human progress.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'gender',
          category: 'Demographics',
          question: 'What is your gender identity?',
          options: [
            { label: 'Male', percent: 49.5 },
            { label: 'Female', percent: 49.5 },
            { label: 'Non-binary / Other', percent: 1.0 }
          ],
          insight: {
            stat: (p) => p < 2 ? '~1%' : '~50%',
            label: 'of the world',
            getText: (opt) => {
              const insights = {
                'Male': 'At birth, there are about 105 males for every 100 females. But women live longer on average, balancing the adult population almost perfectly.',
                'Female': 'Women represent half of humanity and the majority of people over 60. Life expectancy for women exceeds men in every country on Earth.',
                'Non-binary / Other': 'Gender diversity is documented across cultures throughout history—from Two-Spirit people in Indigenous North America to Hijra in South Asia.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'continent',
          category: 'Location',
          question: 'Which continent do you live on?',
          options: [
            { label: 'Asia', percent: 59.4 },
            { label: 'Africa', percent: 17.9 },
            { label: 'Europe', percent: 9.3 },
            { label: 'Latin America', percent: 8.2 },
            { label: 'North America', percent: 4.6 },
            { label: 'Oceania', percent: 0.6 }
          ],
          insight: {
            stat: (p) => p < 1 ? '0.6%' : `${p.toFixed(1)}%`,
            label: 'of humanity lives here',
            getText: (opt) => {
              const insights = {
                'Asia': 'Six out of every ten humans live in Asia. If Asia were its own planet, it would still be the third most populous—after only itself.',
                'Africa': 'Africa has the youngest population of any continent. By 2100, 4 out of 10 humans may be African.',
                'Europe': 'Europe\'s share of world population has shrunk from 22% in 1950 to under 10% today—the most dramatic demographic shift of any continent.',
                'Latin America': 'Latin America is the most urbanized region on Earth—over 80% live in cities. São Paulo alone has more people than many countries.',
                'North America': 'Less than 5% of humanity lives here, yet this region produces about a quarter of all global economic output.',
                'Oceania': 'Only 45 million people live across Oceania—fewer than the population of Spain. You are on humanity\'s most remote frontier.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'urban',
          category: 'Location',
          question: 'Do you live in an urban or rural area?',
          options: [
            { label: 'Urban (city/suburbs)', percent: 57 },
            { label: 'Rural (countryside)', percent: 43 }
          ],
          insight: {
            stat: (p) => `${p}%`,
            label: 'of all people',
            getText: (opt) => {
              const insights = {
                'Urban (city/suburbs)': '2007 marked a turning point: for the first time in human history, more people lived in cities than countryside. You are part of the urban majority.',
                'Rural (countryside)': 'Rural communities produce most of the world\'s food. The 3.4 billion people outside cities sustain the other 4.6 billion.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'height',
          category: 'Physical Traits',
          question: 'How would you describe your height?',
          dependsOn: 'gender',
          getOptions: (answers) => {
            const isMale = answers.gender === 'Male';
            if (isMale) {
              return [
                { label: 'Short (under 5\'6" / 168cm)', percent: 25 },
                { label: 'Below average (5\'6"-5\'8")', percent: 25 },
                { label: 'Average (5\'9"-5\'11")', percent: 30 },
                { label: 'Above average (6\'0"-6\'2")', percent: 15 },
                { label: 'Tall (over 6\'2" / 188cm)', percent: 5 }
              ];
            } else {
              return [
                { label: 'Short (under 5\'1" / 155cm)', percent: 20 },
                { label: 'Below average (5\'1"-5\'3")', percent: 25 },
                { label: 'Average (5\'4"-5\'6")', percent: 35 },
                { label: 'Above average (5\'7"-5\'9")', percent: 15 },
                { label: 'Tall (over 5\'9" / 175cm)', percent: 5 }
              ];
            }
          },
          insight: {
            stat: (p) => p <= 5 ? '5%' : `${p}%`,
            label: 'share your height range',
            getText: (opt, answers) => {
              if (opt.label.includes('Short')) {
                return 'Height varies dramatically by region—Dutch people average 6\' while Timorese average 5\'3". Your height is shaped by both genes and nutrition.';
              }
              if (opt.label.includes('Tall')) {
                return 'Being significantly taller than average puts you in an elite minority. Height is 80% genetics and 20% environment—nutrition, healthcare, and lifestyle.';
              }
              return 'You fall within the middle range of human height—the most common zone across our species. This is where most humans throughout history have been.';
            }
          }
        },
        {
          id: 'eyeColor',
          category: 'Physical Traits',
          question: 'What is your eye color?',
          options: [
            { label: 'Brown', percent: 79 },
            { label: 'Blue', percent: 8 },
            { label: 'Hazel', percent: 5 },
            { label: 'Amber', percent: 5 },
            { label: 'Green', percent: 2 },
            { label: 'Gray', percent: 1 }
          ],
          insight: {
            stat: (p) => p <= 2 ? `${p}%` : `${p}%`,
            label: 'of humans',
            getText: (opt) => {
              const insights = {
                'Brown': 'Brown eyes are the ancestral human default. Every human on Earth had brown eyes until about 10,000 years ago, when a mutation appeared near the Black Sea.',
                'Blue': 'Every blue-eyed person on Earth shares a single common ancestor who lived 6,000-10,000 years ago. You are all one family.',
                'Hazel': 'Hazel eyes are a beautiful mystery—part melanin, part light scattering. Your eye color can appear to shift with lighting and mood.',
                'Amber': 'True amber eyes get their golden color from lipochrome—the same pigment that gives wolves their striking yellow gaze. It\'s exceptionally rare in humans.',
                'Green': 'Green is the rarest eye color on Earth. Most green-eyed people live in Northern and Central Europe. You carry a rare genetic legacy.',
                'Gray': 'Gray eyes are the rarest of all—less melanin than blue eyes, with more collagen. Genetically, you are a true outlier.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'hairColor',
          category: 'Physical Traits',
          question: 'What is your natural hair color?',
          options: [
            { label: 'Black', percent: 75 },
            { label: 'Brown', percent: 11 },
            { label: 'Blonde', percent: 2 },
            { label: 'Red', percent: 1 },
            { label: 'Gray/White', percent: 11 }
          ],
          insight: {
            stat: (p) => p <= 2 ? `${p}%` : `${p}%`,
            label: 'of people worldwide',
            getText: (opt) => {
              const insights = {
                'Black': 'Black hair is humanity\'s original color—dominant across Asia, Africa, and Latin America. It\'s the ancestral shade we\'ve carried for hundreds of thousands of years.',
                'Brown': 'Brown hair emerged in Europe after humans left Africa. It represents the midpoint on the melanin spectrum.',
                'Blonde': 'Natural blonde hair is exceptionally rare globally—found mainly in Northern Europe. It evolved only about 11,000 years ago.',
                'Red': 'Red hair is the rarest—caused by a variant of the MC1R gene. Scotland holds the record at 13%. You carry ancient Neanderthal genetic traces.',
                'Gray/White': 'Hair grays when melanocyte stem cells stop producing pigment. The timing is mostly genetic—some gray at 20, others never.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'handedness',
          category: 'Physical Traits',
          question: 'Which hand do you write with?',
          options: [
            { label: 'Right', percent: 89 },
            { label: 'Left', percent: 10 },
            { label: 'Ambidextrous', percent: 1 }
          ],
          insight: {
            stat: (p) => p === 1 ? '1%' : p === 10 ? '10%' : `${p}%`,
            label: 'of humans',
            getText: (opt) => {
              const insights = {
                'Right': 'Right-handedness has dominated for at least 500,000 years. Stone tools from prehistoric times show the same 90/10 split we see today.',
                'Left': 'Left-handedness has stayed stable at 10% for millennia—suggesting it provides some evolutionary advantage. In sports and combat, lefties have an edge.',
                'Ambidextrous': 'True ambidexterity—equal skill with both hands—is extraordinarily rare. Most "ambidextrous" people still have a slight preference.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'bloodType',
          category: 'Physical Traits',
          question: 'What is your blood type?',
          options: [
            { label: 'O+', percent: 37.4 },
            { label: 'A+', percent: 35.7 },
            { label: 'B+', percent: 8.5 },
            { label: 'AB+', percent: 3.4 },
            { label: 'O-', percent: 6.6 },
            { label: 'A-', percent: 6.3 },
            { label: 'B-', percent: 1.5 },
            { label: 'AB-', percent: 0.6 },
            { label: 'Don\'t know', percent: 30, skip: true }
          ],
          insight: {
            stat: (p) => p < 2 ? `${p.toFixed(1)}%` : `${p.toFixed(1)}%`,
            label: 'of the world',
            getText: (opt) => {
              if (opt.label === 'Don\'t know') return 'About 30% of people don\'t know their blood type. It\'s worth finding out—it could save your life in an emergency.';
              if (opt.label === 'AB-') return 'AB- is the rarest blood type on Earth. Only about 48 million people share your type. In emergencies, finding compatible blood can be challenging.';
              if (opt.label.includes('-')) return 'Rh-negative blood is less common than positive. The Rh factor was only discovered in 1940—one of medicine\'s recent revelations.';
              if (opt.label === 'O+') return 'O+ is the universal donor for positive blood types. In emergencies, your blood can save almost anyone.';
              return 'Blood type distribution varies dramatically by region. Type B is most common in Central Asia, while Type A dominates Europe.';
            }
          }
        },
        {
          id: 'glasses',
          category: 'Physical Traits',
          question: 'Do you wear glasses or contact lenses?',
          options: [
            { label: 'Yes', percent: 36 },
            { label: 'No', percent: 64 }
          ],
          insight: {
            stat: (p) => `${p}%`,
            label: 'of adults',
            getText: (opt) => {
              const insights = {
                'Yes': 'Vision problems have skyrocketed with modern life. In South Korea and Singapore, up to 90% of young adults are nearsighted—an epidemic of myopia.',
                'No': 'Natural good vision is becoming rarer. Screen time, less outdoor activity, and close-up work are changing human eyesight globally.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'languages',
          category: 'Life Experience',
          question: 'How many languages can you hold a conversation in?',
          options: [
            { label: '1 language', percent: 40 },
            { label: '2 languages', percent: 43 },
            { label: '3 languages', percent: 13 },
            { label: '4+ languages', percent: 4 }
          ],
          insight: {
            stat: (p) => p <= 4 ? `${p}%` : `${p}%`,
            label: 'of people',
            getText: (opt) => {
              const insights = {
                '1 language': 'Monolingualism is actually unusual globally—concentrated mainly in English-speaking countries. Most of humanity grows up bilingual.',
                '2 languages': 'Bilingualism is the human norm. Your brain is wired for multiple languages—it enhances cognitive flexibility and may delay dementia.',
                '3 languages': 'Trilingualism is common in multilingual nations like Switzerland, Belgium, and much of Africa. You have access to three different worlds.',
                '4+ languages': 'Polyglots are rare. Speaking four or more languages puts you in an elite group—you can communicate with billions more people than most.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'education',
          category: 'Life Experience',
          question: 'What is your highest level of education?',
          options: [
            { label: 'No formal education', percent: 14 },
            { label: 'Primary school', percent: 26 },
            { label: 'Secondary school', percent: 40 },
            { label: 'University degree', percent: 15 },
            { label: 'Graduate degree', percent: 5 }
          ],
          insight: {
            stat: (p) => p <= 5 ? `${p}%` : `${p}%`,
            label: 'of adults globally',
            getText: (opt) => {
              const insights = {
                'No formal education': 'About 750 million adults worldwide cannot read or write. Two-thirds are women. Access to education remains humanity\'s great inequality.',
                'Primary school': 'Basic literacy was rare for most of human history. Completing primary school means you can do something most of your ancestors could not.',
                'Secondary school': 'Secondary completion varies wildly—from 10% in some countries to 99% in others. Geography is still destiny for education.',
                'University degree': 'A bachelor\'s degree puts you in the top 15% of global educational attainment. This number is rising rapidly.',
                'Graduate degree': 'A graduate degree places you among the most educated 5% of humans who have ever lived. For most of history, this was unimaginable.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'relationship',
          category: 'Life Circumstances',
          question: 'What is your relationship status?',
          options: [
            { label: 'Single', percent: 32 },
            { label: 'In a relationship', percent: 18 },
            { label: 'Married', percent: 42 },
            { label: 'Divorced/Separated', percent: 5 },
            { label: 'Widowed', percent: 3 }
          ],
          insight: {
            stat: (p) => `${p}%`,
            label: 'of adults',
            getText: (opt) => {
              const insights = {
                'Single': 'Single adults are increasing everywhere. The median age of first marriage has risen 5+ years since 1990 in most developed countries.',
                'In a relationship': 'Cohabitation without marriage is increasingly common globally, though rates vary enormously by culture and religion.',
                'Married': 'Marriage remains the most common relationship structure. About 750 million marriages exist worldwide right now.',
                'Divorced/Separated': 'Divorce rates vary from under 1% in some countries to over 50% in others. Culture, religion, and law all play a role.',
                'Widowed': 'There are 258 million widows worldwide—about 3% of all adults. Most are women, due to longer female life expectancy.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'children',
          category: 'Life Circumstances',
          question: 'Do you have children?',
          options: [
            { label: 'No children', percent: 45 },
            { label: '1 child', percent: 18 },
            { label: '2 children', percent: 22 },
            { label: '3+ children', percent: 15 }
          ],
          insight: {
            stat: (p) => `${p}%`,
            label: 'of adults',
            getText: (opt) => {
              const insights = {
                'No children': 'Childlessness is rising dramatically in developed countries. About 44% of US adults under 50 have no children—a historic shift.',
                '1 child': 'One-child families became common after China\'s policy (1980-2015) shaped a generation. They\'re now rising in Europe too.',
                '2 children': 'Two children is roughly the "replacement rate" needed to maintain population. Many countries are now below this threshold.',
                '3+ children': 'Larger families are most common in Sub-Saharan Africa, where women average 4.6 children. These families will shape the future.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'siblings',
          category: 'Life Circumstances',
          question: 'How many siblings do you have?',
          options: [
            { label: 'None (only child)', percent: 15 },
            { label: '1 sibling', percent: 30 },
            { label: '2 siblings', percent: 25 },
            { label: '3+ siblings', percent: 30 }
          ],
          insight: {
            stat: (p) => `${p}%`,
            label: 'of people',
            getText: (opt) => {
              const insights = {
                'None (only child)': 'Only children are most common in urban China (up to 90% in cities) and increasingly in Europe. Birth rates are falling everywhere.',
                '1 sibling': 'Having one sibling is now typical in developed countries where fertility hovers around 2 children per family.',
                '2 siblings': 'Growing up with two siblings was the norm for Baby Boomers but is becoming less common as family sizes shrink.',
                '3+ siblings': 'Large families remain the norm in parts of Africa, the Middle East, and traditional religious communities worldwide.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'pets',
          category: 'Lifestyle',
          question: 'Do you have a pet?',
          options: [
            { label: 'No pets', percent: 43 },
            { label: 'Dog(s)', percent: 33 },
            { label: 'Cat(s)', percent: 23 },
            { label: 'Other pet(s)', percent: 12 }
          ],
          insight: {
            stat: (p) => `${p}%`,
            label: 'of households',
            getText: (opt) => {
              const insights = {
                'No pets': 'Pet ownership varies wildly—from 15% in South Korea to 80% in Argentina. Culture and living space shape our animal companions.',
                'Dog(s)': 'Humans and dogs have been partners for 15,000-40,000 years—longer than agriculture. There are 900 million dogs alive today.',
                'Cat(s)': 'Cats domesticated themselves about 10,000 years ago, attracted to the mice around our grain stores. There are 600 million pet cats worldwide.',
                'Other pet(s)': 'Fish are actually the most numerous pets by count—over 140 million in the US alone. Humans crave animal companionship in all forms.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'swimming',
          category: 'Abilities',
          question: 'Can you swim?',
          options: [
            { label: 'Yes, confidently', percent: 40 },
            { label: 'Somewhat', percent: 15 },
            { label: 'No', percent: 45 }
          ],
          insight: {
            stat: (p) => `${p}%`,
            label: 'of humans',
            getText: (opt) => {
              const insights = {
                'Yes, confidently': 'Swimming ability varies hugely—over 95% in the Netherlands can swim, but only 40% in Bangladesh. Geography is destiny.',
                'Somewhat': 'Partial swimming ability is common—many people can stay afloat but wouldn\'t feel safe in deep or rough water.',
                'No': 'About half of all humans cannot swim. Drowning remains one of the leading causes of accidental death worldwide.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'travel',
          category: 'Life Experience',
          question: 'Have you traveled to another country?',
          options: [
            { label: 'Never', percent: 60 },
            { label: '1-3 countries', percent: 25 },
            { label: '4-10 countries', percent: 10 },
            { label: '10+ countries', percent: 5 }
          ],
          insight: {
            stat: (p) => p <= 5 ? `${p}%` : `${p}%`,
            label: 'of people',
            getText: (opt) => {
              const insights = {
                'Never': 'Most humans never leave their country of birth. Only about 4% of the world\'s population travels internationally each year.',
                '1-3 countries': 'Visiting a few countries puts you ahead of most of humanity in travel experience. Borders shape lives.',
                '4-10 countries': 'You\'ve seen more of the world than 85% of people ever will. Travel requires resources most humans don\'t have.',
                '10+ countries': 'You are among the most well-traveled 5% of humans. The most-traveled person alive has visited all 193 UN countries.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'tongueRoll',
          category: 'Genetics',
          question: 'Can you roll your tongue?',
          options: [
            { label: 'Yes', percent: 70 },
            { label: 'No', percent: 30 }
          ],
          insight: {
            stat: (p) => `${p}%`,
            label: 'of people',
            getText: (opt) => {
              const insights = {
                'Yes': 'Tongue rolling was once thought to be simple genetics, but it\'s more complex. Identical twins don\'t always share the ability—practice can matter.',
                'No': 'Not rolling your tongue puts you in the minority. Scientists once used this as a simple genetics example, but it\'s actually more nuanced.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'religion',
          category: 'Beliefs',
          question: 'What best describes your beliefs?',
          options: [
            { label: 'Christianity', percent: 31.1 },
            { label: 'Islam', percent: 24.9 },
            { label: 'Hinduism', percent: 15.2 },
            { label: 'Buddhism', percent: 6.6 },
            { label: 'Other religion', percent: 6.0 },
            { label: 'Non-religious', percent: 15.6 }
          ],
          insight: {
            stat: (p) => `${p.toFixed(1)}%`,
            label: 'of humanity',
            getText: (opt) => {
              const insights = {
                'Christianity': 'Christianity spans 2.4 billion people across every continent. It\'s the majority faith in 157 of 195 countries.',
                'Islam': 'Islam is the fastest-growing major religion. Projections suggest it may become the world\'s largest faith by 2075.',
                'Hinduism': 'Hinduism is humanity\'s oldest major religion, with roots stretching back over 4,000 years. It shaped a civilization.',
                'Buddhism': 'Buddhism\'s 520 million followers span from Sri Lanka to Japan. Its influence extends far beyond self-identified Buddhists.',
                'Other religion': 'This includes Judaism, Sikhism, indigenous religions, and thousands of other traditions that shape billions of lives.',
                'Non-religious': 'The non-religious population is growing fastest in Europe, North America, and East Asia. It\'s a recent historical phenomenon.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'diet',
          category: 'Lifestyle',
          question: 'How would you describe your diet?',
          options: [
            { label: 'Omnivore', percent: 86 },
            { label: 'Vegetarian', percent: 8 },
            { label: 'Vegan', percent: 1 },
            { label: 'Pescatarian', percent: 3 },
            { label: 'Other restriction', percent: 2 }
          ],
          insight: {
            stat: (p) => p <= 3 ? `${p}%` : `${p}%`,
            label: 'of people globally',
            getText: (opt) => {
              const insights = {
                'Omnivore': 'Most humans eat an omnivorous diet. Global meat consumption is rising—especially in developing countries as incomes grow.',
                'Vegetarian': 'India has the highest vegetarian population at about 40%. Globally, vegetarianism is growing but remains a minority.',
                'Vegan': 'Veganism is still rare globally—about 1%—but growing fastest in Western countries. It\'s tripled in some places since 2014.',
                'Pescatarian': 'Fish-based diets are traditional in coastal and island communities. About 3 billion people rely on seafood as primary protein.',
                'Other restriction': 'This includes halal, kosher, gluten-free, and medical restrictions affecting billions. Diet is identity.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'sleep',
          category: 'Lifestyle',
          question: 'How much sleep do you typically get?',
          options: [
            { label: 'Less than 6 hours', percent: 20 },
            { label: '6-7 hours', percent: 35 },
            { label: '7-8 hours', percent: 30 },
            { label: 'More than 8 hours', percent: 15 }
          ],
          insight: {
            stat: (p) => `${p}%`,
            label: 'of adults',
            getText: (opt) => {
              const insights = {
                'Less than 6 hours': 'Chronic sleep deprivation affects about 1.5 billion people. It\'s linked to heart disease, obesity, and shortened lifespan.',
                '6-7 hours': 'This is the most common sleep duration globally, but it\'s below the 7-9 hours recommended for optimal health.',
                '7-8 hours': 'You\'re in the sweet spot. This sleep range is associated with the best health outcomes, cognitive function, and longevity.',
                'More than 8 hours': 'Long sleep can indicate good self-care—or sometimes underlying health conditions. Context matters.'
              };
              return insights[opt.label];
            }
          }
        },
        {
          id: 'coffee',
          category: 'Lifestyle',
          question: 'Do you drink coffee?',
          options: [
            { label: 'Daily', percent: 47 },
            { label: 'Sometimes', percent: 23 },
            { label: 'Rarely', percent: 12 },
            { label: 'Never', percent: 18 }
          ],
          insight: {
            stat: (p) => `${p}%`,
            label: 'of adults worldwide',
            getText: (opt) => {
              const insights = {
                'Daily': 'About 2 billion cups of coffee are consumed every day. Finland leads consumption—Finns drink more coffee per capita than any nation.',
                'Sometimes': 'Occasional coffee drinking is common globally. The industry grows about 2% each year—humanity\'s caffeine love affair continues.',
                'Rarely': 'Infrequent coffee drinking often reflects caffeine sensitivity or cultural preference for tea. Both have deep histories.',
                'Never': 'Non-coffee drinkers are more common in tea cultures—China, India, the UK, and much of the Middle East prefer other brews.'
              };
              return insights[opt.label];
            }
          }
        }
      ];

      // ============================================
      // ARCHETYPES
      // ============================================
      const ARCHETYPES = [
        {
          id: 'unicorn',
          name: 'The Unicorn',
          description: 'Your combination of traits is extraordinarily rare. While each trait exists in millions of people, finding someone who shares your complete profile would be like finding a specific grain of sand on a beach.',
          check: (uniquenessScore) => uniquenessScore >= 90
        },
        {
          id: 'one-percenter',
          name: 'The One Percenter',
          description: 'You carry multiple traits that each place you in rare categories. This combination of uncommon characteristics makes your profile highly distinctive.',
          check: (uniquenessScore, rareCount) => rareCount >= 5 || uniquenessScore >= 75
        },
        {
          id: 'outlier',
          name: 'The Outlier',
          description: 'Across many dimensions, you consistently fall outside the statistical mainstream. You\'re accustomed to being different—it\'s part of who you are.',
          check: (uniquenessScore, rareCount) => rareCount >= 4 && uniquenessScore >= 60
        },
        {
          id: 'genetic-lottery',
          name: 'The Genetic Lottery',
          description: 'Your physical traits are notably uncommon. Nature gave you a distinctive combination of characteristics that set you apart visually.',
          check: (uniquenessScore, rareCount, answers, physicalRareCount) => physicalRareCount >= 2 && uniquenessScore >= 50
        },
        {
          id: 'global-citizen',
          name: 'The Global Citizen',
          description: 'Your experiences span beyond typical boundaries. Languages, travel, and diverse experiences have shaped a worldview that transcends borders.',
          check: (uniquenessScore, rareCount, answers) =>
            answers.travel === '10+ countries' || answers.languages === '4+ languages' || answers.languages === '3 languages'
        },
        {
          id: 'road-less-traveled',
          name: 'The Road Less Traveled',
          description: 'Your life choices and circumstances have led you down an uncommon path. Your story diverges from the statistical mainstream in meaningful ways.',
          check: (uniquenessScore) => uniquenessScore >= 55
        },
        {
          id: 'balanced',
          name: 'The Balanced',
          description: 'You have a thoughtful mix of common and rare traits. Like a compelling character, you\'re relatable in some ways and surprising in others.',
          check: (uniquenessScore, rareCount) => rareCount >= 1 && rareCount <= 3 && uniquenessScore >= 35 && uniquenessScore < 55
        },
        {
          id: 'common-thread',
          name: 'The Common Thread',
          description: 'Your traits connect you deeply to the human mainstream. You share fundamental experiences with billions of people—there\'s profound beauty in that connection.',
          check: (uniquenessScore) => uniquenessScore >= 20 && uniquenessScore < 35
        },
        {
          id: 'statistical-norm',
          name: 'The Statistical Norm',
          description: 'You align remarkably well with global averages. Looking at you is like looking at a reflection of humanity\'s center point—you embody what is most common.',
          check: (uniquenessScore) => uniquenessScore < 20
        },
        {
          id: 'unique-you',
          name: 'Uniquely You',
          description: 'Your specific combination of traits creates a profile that is distinctly your own. Statistics aside, there is no one quite like you.',
          check: () => true
        }
      ];

      // ============================================
      // STATE
      // ============================================
      let currentQuestion = 0;
      let answers = {};
      let populationPercent = 100;
      let answeredQuestions = [];
      let skippedQuestions = [];

      // ============================================
      // DOM ELEMENTS
      // ============================================
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      const startScreen = document.getElementById('start-screen');
      const questionScreen = document.getElementById('question-screen');
      const insightPanel = document.getElementById('insight-panel');
      const resultsScreen = document.getElementById('results-screen');

      // ============================================
      // CANVAS - DOT VISUALIZATION
      // ============================================
      const TOTAL_DOTS = 100000;
      const PEOPLE_PER_DOT = 80000;
      let dots = [];
      let targetActiveDots = TOTAL_DOTS;
      let width, height;
      let time = 0;

      function initCanvas() {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
        initDots();
        animate();
      }

      function initDots() {
        dots = [];
        const cols = Math.ceil(Math.sqrt(TOTAL_DOTS * (width / height)));
        const rows = Math.ceil(TOTAL_DOTS / cols);
        const spacingX = width / cols;
        const spacingY = height / rows;

        for (let i = 0; i < TOTAL_DOTS; i++) {
          const col = i % cols;
          const row = Math.floor(i / cols);
          const baseX = col * spacingX + spacingX / 2;
          const baseY = row * spacingY + spacingY / 2;

          dots.push({
            x: baseX + (Math.random() - 0.5) * spacingX * 0.4,
            y: baseY + (Math.random() - 0.5) * spacingY * 0.4,
            baseX: baseX,
            baseY: baseY,
            active: true,
            opacity: 1,
            targetOpacity: 1,
            hue: 220 + Math.random() * 20,
            phase: Math.random() * Math.PI * 2,
            speed: 0.5 + Math.random() * 0.5
          });
        }
      }

      function updateDots() {
        const newActiveDots = Math.max(1, Math.round(TOTAL_DOTS * (populationPercent / 100)));

        if (newActiveDots !== targetActiveDots) {
          targetActiveDots = newActiveDots;

          const activeDotIndices = dots.map((d, i) => d.targetOpacity > 0 ? i : -1).filter(i => i >= 0);
          const currentActive = activeDotIndices.length;
          const toDeactivate = currentActive - targetActiveDots;

          if (toDeactivate > 0) {
            for (let i = activeDotIndices.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [activeDotIndices[i], activeDotIndices[j]] = [activeDotIndices[j], activeDotIndices[i]];
            }

            for (let i = 0; i < toDeactivate && i < activeDotIndices.length; i++) {
              dots[activeDotIndices[i]].targetOpacity = 0;
            }
          }
        }

        dots.forEach(dot => {
          dot.opacity += (dot.targetOpacity - dot.opacity) * 0.03;
          if (dot.opacity < 0.01) dot.opacity = 0;
          dot.active = dot.opacity > 0;
        });
      }

      function drawDots() {
        // Subtle gradient background
        const bgGradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, Math.max(width, height) * 0.7);
        bgGradient.addColorStop(0, '#0F0F0F');
        bgGradient.addColorStop(1, '#0A0A0A');
        ctx.fillStyle = bgGradient;
        ctx.fillRect(0, 0, width, height);

        time += 0.008;
        const dotSize = Math.max(1, Math.min(2.5, width / 600));
        const activeCount = dots.filter(d => d.active).length;
        const isFiltering = activeCount < TOTAL_DOTS * 0.9;
        const filterIntensity = 1 - (activeCount / TOTAL_DOTS);

        // Wave effect parameters
        const waveAmplitude = 2;
        const waveFrequency = 0.003;

        dots.forEach(dot => {
          if (dot.opacity > 0.01) {
            // Subtle wave motion for active dots
            let drawX = dot.x;
            let drawY = dot.y;

            if (dot.opacity > 0.5) {
              const wave = Math.sin(time * 2 + dot.x * waveFrequency + dot.y * waveFrequency) * waveAmplitude;
              drawX += wave * 0.5;
              drawY += Math.cos(time * 2 + dot.x * waveFrequency) * waveAmplitude * 0.5;
            }

            const breathe = Math.sin(time * dot.speed + dot.phase) * 0.3 + 0.7;
            const alpha = dot.opacity * breathe * (isFiltering && dot.opacity > 0.5 ? 0.9 : 0.4);

            // Dynamic coloring based on filter state
            if (dot.opacity > 0.5 && isFiltering) {
              // Shift from white to blue to cyan as more filtering happens
              const hueShift = filterIntensity * 30;
              const saturation = 80 + filterIntensity * 20;
              const lightness = 55 + filterIntensity * 15;
              ctx.fillStyle = `hsla(${dot.hue + hueShift}, ${saturation}%, ${lightness}%, ${alpha})`;
            } else if (dot.opacity > 0.5) {
              // Subtle color variation for idle state
              const idleHue = 220 + Math.sin(time + dot.phase) * 10;
              ctx.fillStyle = `hsla(${idleHue}, 20%, 80%, ${alpha * 0.6})`;
            } else {
              // Fading dots
              ctx.fillStyle = `rgba(60, 60, 70, ${alpha * 0.4})`;
            }

            const size = dotSize * (dot.opacity > 0.5 ? 1 + filterIntensity * 0.3 : 0.6);
            ctx.beginPath();
            ctx.arc(drawX, drawY, size, 0, Math.PI * 2);
            ctx.fill();
          }
        });

        // Enhanced glow effect for active dots when heavily filtered
        if (activeCount < TOTAL_DOTS * 0.1 && activeCount > 0) {
          ctx.globalCompositeOperation = 'screen';
          dots.forEach(dot => {
            if (dot.opacity > 0.8) {
              const glowSize = 20 + filterIntensity * 15;
              const gradient = ctx.createRadialGradient(dot.x, dot.y, 0, dot.x, dot.y, glowSize);
              gradient.addColorStop(0, `rgba(0, 150, 255, ${0.4 * filterIntensity})`);
              gradient.addColorStop(0.5, `rgba(0, 71, 255, ${0.2 * filterIntensity})`);
              gradient.addColorStop(1, 'rgba(0, 71, 255, 0)');
              ctx.fillStyle = gradient;
              ctx.beginPath();
              ctx.arc(dot.x, dot.y, glowSize, 0, Math.PI * 2);
              ctx.fill();
            }
          });
          ctx.globalCompositeOperation = 'source-over';
        }

        // Connection lines between nearby active dots when very filtered
        if (activeCount < TOTAL_DOTS * 0.01 && activeCount > 1) {
          ctx.strokeStyle = `rgba(0, 71, 255, ${0.15 * filterIntensity})`;
          ctx.lineWidth = 0.5;
          const activeDots = dots.filter(d => d.opacity > 0.8);
          for (let i = 0; i < activeDots.length; i++) {
            for (let j = i + 1; j < activeDots.length; j++) {
              const dist = Math.hypot(activeDots[i].x - activeDots[j].x, activeDots[i].y - activeDots[j].y);
              if (dist < 150) {
                ctx.beginPath();
                ctx.moveTo(activeDots[i].x, activeDots[i].y);
                ctx.lineTo(activeDots[j].x, activeDots[j].y);
                ctx.stroke();
              }
            }
          }
        }
      }

      function animate() {
        updateDots();
        drawDots();
        requestAnimationFrame(animate);
      }

      // ============================================
      // QUESTION LOGIC
      // ============================================
      function getQuestion(index) {
        const q = QUESTIONS[index];
        if (q.dependsOn && q.getOptions) {
          return { ...q, options: q.getOptions(answers) };
        }
        return q;
      }

      function updatePopulationDisplay() {
        const remaining = Math.round(8000000000 * (populationPercent / 100));
        document.getElementById('population-display').textContent = formatNumber(remaining) + ' remaining';
      }

      function showQuestion(index) {
        const q = getQuestion(index);

        // Show live counter
        document.getElementById('live-counter').classList.add('visible');
        updateLiveCounter();

        document.getElementById('progress-fill').style.width = `${((index) / QUESTIONS.length) * 100}%`;
        document.getElementById('question-counter').textContent = `Question ${index + 1} of ${QUESTIONS.length}`;
        document.getElementById('question-number').textContent = q.category;
        document.getElementById('question-text').textContent = q.question;
        updatePopulationDisplay();

        const optionsContainer = document.getElementById('options');
        optionsContainer.innerHTML = '';

        q.options.forEach((opt, i) => {
          if (opt.skip) return;

          const btn = document.createElement('button');
          btn.className = 'option-btn';
          btn.style.animationDelay = `${i * 0.05}s`;
          btn.style.animation = 'slideIn 0.3s ease forwards';
          btn.style.opacity = '0';
          btn.innerHTML = `
            <span>${opt.label}</span>
            <span class="percent">${opt.percent < 1 ? '<1' : opt.percent.toFixed(0)}%</span>
          `;
          btn.addEventListener('click', (e) => selectOption(q, opt, btn, e));
          optionsContainer.appendChild(btn);
        });

        const skipOpt = q.options.find(o => o.skip);
        if (skipOpt) {
          const skipBtn = document.createElement('button');
          skipBtn.className = 'option-btn';
          skipBtn.style.opacity = '0.6';
          skipBtn.innerHTML = `<span>${skipOpt.label}</span>`;
          skipBtn.addEventListener('click', () => skipQuestion());
          optionsContainer.appendChild(skipBtn);
        }

        questionScreen.style.display = 'block';
        questionScreen.classList.remove('fade-out');
        questionScreen.classList.add('fade-in');
        startScreen.style.display = 'none';
        insightPanel.style.display = 'none';
        resultsScreen.style.display = 'none';
      }

      function updateLiveCounter() {
        const remaining = Math.round(8000000000 * (populationPercent / 100));
        document.getElementById('live-count').textContent = formatNumber(remaining);
      }

      function selectOption(question, option, btnElement, event) {
        // Add selection animation
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(btn => {
          if (btn === btnElement) {
            btn.classList.add('selected');
          } else {
            btn.classList.add('not-selected');
          }
        });

        // Create pulse effect at click location
        if (event) {
          createSelectionPulse(event.clientX, event.clientY, option.percent);
        }

        answers[question.id] = option.label;
        answeredQuestions.push({ question, option });
        populationPercent *= (option.percent / 100);

        // Update live counter immediately
        updateLiveCounter();

        // Delay transition for visual feedback
        setTimeout(() => {
          showInsight(question, option);
        }, 400);
      }

      function createSelectionPulse(x, y, percent) {
        const pulse = document.createElement('div');
        pulse.className = 'selection-pulse';
        pulse.style.left = x + 'px';
        pulse.style.top = y + 'px';
        pulse.style.width = '50px';
        pulse.style.height = '50px';
        pulse.style.marginLeft = '-25px';
        pulse.style.marginTop = '-25px';

        // Color based on rarity
        const color = percent < 10 ? 'var(--warm)' : percent < 30 ? 'var(--accent)' : 'rgba(255,255,255,0.3)';
        pulse.style.background = color;

        document.body.appendChild(pulse);
        setTimeout(() => pulse.remove(), 1000);
      }

      function showInsight(question, option) {
        const insight = question.insight;
        const stat = insight.stat(option.percent);
        const label = typeof insight.label === 'function' ? insight.label(option.percent) : insight.label;
        const text = insight.getText(option, answers);

        const statEl = document.getElementById('insight-stat');
        statEl.textContent = stat;
        statEl.classList.remove('counting');
        void statEl.offsetWidth; // Trigger reflow
        statEl.classList.add('counting');

        document.getElementById('insight-label').textContent = label;
        document.getElementById('insight-text').textContent = text;

        // Absolute: people who share THIS trait
        const absoluteRemaining = Math.round(8000000000 * (option.percent / 100));
        animateNumber('remaining-absolute', absoluteRemaining);

        // Cumulative: people matching ALL answers so far
        const cumulativeRemaining = Math.max(1, Math.round(8000000000 * (populationPercent / 100)));
        animateNumber('remaining-cumulative', cumulativeRemaining);

        questionScreen.style.display = 'none';
        questionScreen.classList.add('fade-out');
        insightPanel.style.display = 'block';
        insightPanel.classList.remove('fade-out');
        insightPanel.classList.add('fade-in');
      }

      function animateNumber(elementId, targetValue) {
        const el = document.getElementById(elementId);
        const duration = 800;
        const startTime = performance.now();
        const startValue = 0;

        function update(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);

          // Ease out cubic
          const easeProgress = 1 - Math.pow(1 - progress, 3);
          const currentValue = Math.round(startValue + (targetValue - startValue) * easeProgress);

          el.textContent = formatNumber(currentValue);

          if (progress < 1) {
            requestAnimationFrame(update);
          }
        }

        requestAnimationFrame(update);
      }

      function skipQuestion() {
        skippedQuestions.push(QUESTIONS[currentQuestion].id);

        // Quick fade transition for skips
        questionScreen.classList.add('fade-out');
        setTimeout(() => {
          questionScreen.classList.remove('fade-out');

          currentQuestion++;

          while (currentQuestion < QUESTIONS.length) {
            const q = QUESTIONS[currentQuestion];
            if (q.dependsOn && !answers[q.dependsOn]) {
              skippedQuestions.push(q.id);
              currentQuestion++;
            } else {
              break;
            }
          }

          if (currentQuestion >= QUESTIONS.length) {
            showResults();
          } else {
            showQuestion(currentQuestion);
          }
        }, 250);
      }

      function nextQuestion() {
        currentQuestion++;

        while (currentQuestion < QUESTIONS.length) {
          const q = QUESTIONS[currentQuestion];
          if (q.dependsOn && !answers[q.dependsOn]) {
            skippedQuestions.push(q.id);
            currentQuestion++;
          } else {
            break;
          }
        }

        // Transition out current panel
        insightPanel.classList.add('fade-out');

        setTimeout(() => {
          insightPanel.style.display = 'none';
          insightPanel.classList.remove('fade-out', 'fade-in');

          if (currentQuestion >= QUESTIONS.length) {
            showResults();
          } else {
            showQuestion(currentQuestion);
          }
        }, 300);
      }

      function showResults() {
        // Hide live counter
        document.getElementById('live-counter').classList.remove('visible');

        questionScreen.style.display = 'none';
        insightPanel.style.display = 'none';
        insightPanel.classList.add('fade-out');
        resultsScreen.style.display = 'block';
        resultsScreen.classList.add('fade-in');

        // Calculate metrics
        const traits = answeredQuestions.map(aq => ({
          id: aq.question.id,
          label: aq.option.label,
          percent: aq.option.percent,
          category: aq.question.category
        }));

        const rareTraits = traits.filter(t => t.percent < 10).sort((a, b) => a.percent - b.percent);
        const commonTraits = traits.filter(t => t.percent >= 40);
        const physicalTraits = ['eyeColor', 'hairColor', 'handedness', 'height', 'bloodType'];
        const physicalRareCount = rareTraits.filter(t => physicalTraits.includes(t.id)).length;

        // Uniqueness score (0-100)
        // Based on how rare your overall combination is
        const avgRarity = traits.reduce((sum, t) => sum + (100 - t.percent), 0) / traits.length;
        const rareBonus = rareTraits.length * 5;
        const uniquenessScore = Math.min(99, Math.round(avgRarity + rareBonus));

        // Estimate similar people (more realistic)
        // Use geometric mean approach but with a floor
        const similarPeopleEstimate = calculateSimilarPeople(traits);

        // Determine archetype
        let archetype = ARCHETYPES.find(a => a.check(uniquenessScore, rareTraits.length, answers, physicalRareCount));
        if (!archetype) archetype = ARCHETYPES[ARCHETYPES.length - 1];

        // Populate results
        document.getElementById('archetype-name').textContent = archetype.name;
        document.getElementById('results-description').textContent = archetype.description;

        document.getElementById('similar-people').textContent = formatNumber(similarPeopleEstimate);
        document.getElementById('similarity-note').textContent =
          similarPeopleEstimate > 1000000
            ? 'Sharing most of your key traits'
            : similarPeopleEstimate > 1000
              ? 'With a very similar profile'
              : 'Your exact statistical match is rare';

        document.getElementById('uniqueness-score').textContent = uniquenessScore + '/100';
        document.getElementById('rare-trait-count').textContent = rareTraits.length;
        document.getElementById('common-trait-count').textContent = commonTraits.length;
        document.getElementById('rarest-percentile').textContent =
          rareTraits.length > 0 ? `${rareTraits[0].percent < 1 ? '<1' : rareTraits[0].percent.toFixed(0)}%` : 'N/A';

        // Uniqueness spectrum position
        const markerPosition = Math.min(95, Math.max(5, uniquenessScore));
        document.getElementById('comparison-marker').style.left = `${markerPosition}%`;

        // Trait breakdown
        const traitSection = document.getElementById('trait-section');
        traitSection.innerHTML = '<h3>Your Trait Breakdown</h3>';

        traits.sort((a, b) => a.percent - b.percent).forEach(trait => {
          const rarityClass = trait.percent < 5 ? 'very-rare' : trait.percent < 10 ? 'rare' : '';
          const fillWidth = Math.min(100, trait.percent);

          const div = document.createElement('div');
          div.className = 'trait-item';
          div.innerHTML = `
            <span class="trait-name">${trait.label}</span>
            <span class="trait-rarity">
              <span class="rarity-bar">
                <span class="rarity-fill ${rarityClass}" style="width: ${fillWidth}%"></span>
              </span>
              <span class="percent ${rarityClass}">${trait.percent < 1 ? '<1' : trait.percent.toFixed(0)}%</span>
            </span>
          `;
          traitSection.appendChild(div);
        });
      }

      function calculateSimilarPeople(traits) {
        // More nuanced similarity calculation
        // We use a weighted approach: not pure multiplication (too small)
        // but accounting for trait independence

        if (traits.length === 0) return 8000000000;

        // Group traits by category and take representative sample
        const keyTraits = traits.slice(0, Math.min(10, traits.length));

        // Use geometric mean for core traits, which gives more realistic numbers
        const logSum = keyTraits.reduce((sum, t) => sum + Math.log(t.percent / 100), 0);
        const avgLogProb = logSum / keyTraits.length;

        // Apply partial independence factor (traits aren't fully independent)
        const independenceFactor = 0.6; // 60% independence
        const adjustedLogProb = avgLogProb * independenceFactor * keyTraits.length;

        const probability = Math.exp(adjustedLogProb);
        const estimate = Math.round(8000000000 * probability);

        // Floor of 1, ceiling of 100 million
        return Math.max(1, Math.min(100000000, estimate));
      }

      function formatNumber(num) {
        if (num >= 1000000000) {
          return (num / 1000000000).toFixed(1) + 'B';
        } else if (num >= 1000000) {
          return (num / 1000000).toFixed(1) + 'M';
        } else if (num >= 1000) {
          return Math.round(num / 1000) + 'K';
        }
        return num.toLocaleString();
      }

      function restart() {
        currentQuestion = 0;
        answers = {};
        populationPercent = 100;
        answeredQuestions = [];
        skippedQuestions = [];

        // Animate dots back
        dots.forEach(dot => {
          dot.active = true;
          dot.targetOpacity = 1;
        });
        targetActiveDots = TOTAL_DOTS;

        // Hide live counter
        document.getElementById('live-counter').classList.remove('visible');

        // Transition screens
        resultsScreen.classList.add('fade-out');
        setTimeout(() => {
          resultsScreen.style.display = 'none';
          resultsScreen.classList.remove('fade-out', 'fade-in');
          startScreen.style.display = 'block';
          startScreen.classList.add('fade-in');
        }, 300);
      }

      function copyResults() {
        const archetype = document.getElementById('archetype-name').textContent;
        const score = document.getElementById('uniqueness-score').textContent;
        const similar = document.getElementById('similar-people').textContent;
        const rareCount = document.getElementById('rare-trait-count').textContent;

        const text = `🌍 One in 8 Billion

I'm "${archetype}"

📊 Uniqueness Score: ${score}
👥 Similar people worldwide: ~${similar}
✨ Rare traits: ${rareCount}

How unique are you?`;

        navigator.clipboard.writeText(text).then(() => {
          const btn = document.getElementById('share-btn');
          const originalText = btn.textContent;
          btn.textContent = 'Copied!';
          btn.style.background = 'var(--accent)';
          btn.style.color = 'var(--text)';
          setTimeout(() => {
            btn.textContent = originalText;
            btn.style.background = '';
            btn.style.color = '';
          }, 2000);
        });
      }

      // ============================================
      // EVENT LISTENERS
      // ============================================
      document.getElementById('start-btn').addEventListener('click', () => {
        startScreen.classList.add('fade-out');
        setTimeout(() => {
          startScreen.style.display = 'none';
          startScreen.classList.remove('fade-out', 'fade-in');
          showQuestion(0);
        }, 300);
      });

      document.getElementById('skip-btn').addEventListener('click', skipQuestion);
      document.getElementById('continue-btn').addEventListener('click', nextQuestion);
      document.getElementById('restart-btn').addEventListener('click', restart);
      document.getElementById('share-btn').addEventListener('click', copyResults);

      window.addEventListener('resize', () => {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
        initDots();
      });

      // Initialize
      initCanvas();

    })();
  </script>
</body>
</html>
